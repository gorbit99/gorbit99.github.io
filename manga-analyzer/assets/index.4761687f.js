var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var Q=Object.prototype.hasOwnProperty,ee=Object.prototype.propertyIsEnumerable;var k=(e,n,a)=>n in e?X(e,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[n]=a,P=(e,n)=>{for(var a in n||(n={}))Q.call(n,a)&&k(e,a,n[a]);if(j)for(var a of j(n))ee.call(n,a)&&k(e,a,n[a]);return e},x=(e,n)=>Y(e,Z(n));import"./vendor.0bc0745c.js";const te=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))t(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&t(i)}).observe(document,{childList:!0,subtree:!0});function a(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function t(o){if(o.ep)return;o.ep=!0;const s=a(o);fetch(o.href,s)}};te();function ne(){const e=document.querySelector(".upload__drop-zone"),n=document.querySelector(".upload__file-input"),a=document.querySelector(".upload__button"),t=document.querySelector(".upload__drop-zone-text");n.files=null,a.disabled=!0,e.addEventListener("click",()=>{n.click()}),n.addEventListener("change",()=>{const o=n.files;o!=null&&(a.classList.add("upload__button--excited"),a.classList.remove("upload__button--inactive"),a.disabled=!1,t.textContent=`${o.length} files selected`)}),a.addEventListener("click",()=>{a.classList.remove("upload__button--excited")})}function oe(e){document.querySelector(".upload__button").addEventListener("click",()=>{var o;const a=document.querySelector(".upload__file-input"),t=Array.from((o=a.files)!=null?o:[]);e(t)})}const S={adjective:"\u5F62\u5BB9\u8A5E",adverb:"\u526F\u8A5E",adnominal:"\u9023\u4F53\u8A5E",filler:"\u30D5\u30A3\u30E9\u30FC",conjunction:"\u63A5\u7D9A\u8A5E",noun:"\u540D\u8A5E",auxiliaryVerb:"\u52A9\u52D5\u8A5E",interjection:"\u611F\u52D5\u8A5E",other:"\u305D\u306E\u4ED6",prefix:"\u63A5\u982D\u8A5E",particle:"\u52A9\u8A5E",symbol:"\u8A18\u53F7",verb:"\u52D5\u8A5E"};function ae(){var e;(e=document.querySelector(".loading"))==null||e.classList.remove("loading--hidden")}function re(){var e;(e=document.querySelector(".loading"))==null||e.classList.add("loading--hidden")}function N(e){const n=document.querySelector(".loading__text");n.textContent=e}let I;async function ce(e){ae(),se(e);const n=await le(e),a=ie(n);I===void 0&&(I=await de());const t=me(a);return re(),{lines:a,words:t}}function se(e){const n=a=>parseInt(a.name.split(".")[0]);return e.sort((a,t)=>n(a)-n(t))}async function le(e){const n=[];for(const a of e){N(`Loading files... ${n.length+1}/${e.length}`);const t=await ue(a);n.push(t)}return n}async function ue(e){const n=new FileReader;return n.readAsText(e),new Promise((a,t)=>{n.onload=()=>{const o=JSON.parse(n.result);a(o)},n.onerror=()=>{t(n.error)}})}function ie(e){return e.map(n=>n.blocks.map(a=>a.lines.join(" ")))}function de(){return N("Loading kuromoji..."),new Promise((e,n)=>{kuromoji.builder({dicPath:"https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict"}).build((a,t)=>{a&&n(a),e(t)})})}function me(e){return N("Extracting words..."),e.map(n=>n.flatMap(a=>ge(a)))}function ge(e){const n=[S.noun,S.verb,S.adverb,S.adjective,S.adnominal];return I.tokenize(e).filter(t=>n.includes(t.pos)&&t.basic_form!=="*").map(t=>t.basic_form)}function w(e){return(Math.round(e*100)/100).toString()}function q(e,n,a,t){const o=e.querySelector(".results__info-value"),s=e.querySelector(".results__info-average"),i=e.querySelector(".results__info-deviation");if(o.textContent=w(n),a!==void 0&&t!==void 0){s.textContent=w(a);const d=t>0?"+":"";i.textContent=d+w(t)}}const B={showAveragesFor:"abbc"};function fe(){const e=document.querySelector(".settings__icon"),n=document.querySelector(".settings");e.addEventListener("click",()=>{n.classList.toggle("settings--open")});const a=V();for(const t in a){const o=document.querySelector(`#${t}`);o.value=a[t],o.addEventListener("change",()=>{a[t]=o.value,R(a)})}}function V(){return window.localStorage.getItem("settings")===null?(R(B),B):JSON.parse(window.localStorage.getItem("settings"))}function R(e){window.localStorage.setItem("settings",JSON.stringify(e))}function W(e){return V()[e]}function pe(e,n,a,t){const o=document.querySelector("#diagramTemplate"),s=o.content.querySelector(".results__diagram").cloneNode(!0),i=o.content.querySelector("#diagramColumnTemplate"),d=o.content.querySelector("#diagramColumnWithHorizontalTemplate"),c=o.content.querySelector("#diagramHorizontalLineTemplate"),m=o.content.querySelector("#diagramAverageLineTemplate"),r=o.content.querySelector("#diagramValueLineTemplate"),l=s.querySelector(".results__diagram-data"),g=Math.min(...e.map(b=>b.value),...a?[a]:[],...(t!=null?t:[]).map(b=>b.value)),f=Math.max(...e.map(b=>b.value),...a?[a]:[],...(t!=null?t:[]).map(b=>b.value)),p=Math.max(...e.map(b=>b.count),...(t!=null?t:[]).map(b=>b.count)),u=p*1.25,_=Math.max(Math.floor(g-3),0),E=Math.ceil(f+3);return ve(_,E,u,e,l,i,d),_e(u,p,c,l),he(n,a,E,l,m,r),s}function ve(e,n,a,t,o,s,i){var m,r;const d=100/(n-e+1),c=Math.ceil(20/d);for(let l=0;l<=n-e;l++){const g=e+l,f=(r=(m=t.find(u=>u.value===g))==null?void 0:m.count)!=null?r:0,p=f/a*100;if(l%c===0&&l!==0){const u=i.content.firstElementChild.cloneNode(!0),_=u.querySelector(".results__diagram-column-value"),E=u.querySelector(".results__diagram-horizontal-value");_.textContent=`${g}: ${f}`,E.textContent=w(g),u.style.height=`${p}%`,u.style.width=`${d}%`,o.appendChild(u)}else{const u=s.content.firstElementChild.cloneNode(!0),_=u.querySelector(".results__diagram-column-value");_.textContent=`${g}: ${f}`,u.style.height=`${p}%`,u.style.width=`${d}%`,o.appendChild(u)}}}function _e(e,n,a,t){const o=Math.ceil(n/5),s=o/e*100,i=Math.floor(e/o);for(let d=0;d<i;d++){const c=a.content.firstElementChild.cloneNode(!0);c.style.height=`${s*(d+1)}%`;const m=c.querySelector(".results__diagram-horizontal-line-text");m.textContent=(o*(d+1)).toString(),t.appendChild(c)}}function he(e,n,a,t,o,s){const i=e/a*100,d=[];if(n){const r=n/a*100,l=o.content.firstElementChild.cloneNode(!0);l.style.width=`${r}%`;const g=l.querySelector(".results__diagram-average-text");g.textContent=w(n),d.push(l)}const c=s.content.firstElementChild.cloneNode(!0);c.style.width=`${i}%`;const m=c.querySelector(".results__diagram-value-text");m.textContent=w(e),d.push(c),n&&n>e&&d.reverse(),t.append(...d)}async function G(){if(W("showAveragesFor")==="none")return;const e=await F(),n=e.length,a=e.map(r=>r.pages.count).reduce((r,l)=>r+l,0)/n,t=e.map(r=>r.pages.meaningful).reduce((r,l)=>r+l,0)/n,o=Math.sqrt(e.map(r=>Math.pow(r.pages.count-a,2)).reduce((r,l)=>r+l,0)/n),s=Math.sqrt(e.map(r=>Math.pow(r.pages.meaningful-t,2)).reduce((r,l)=>r+l,0)/n),i=r=>{const l=r.map(u=>u.count).reduce((u,_)=>u+_,0)/n,g=Math.sqrt(r.map(u=>Math.pow(u.count-l,2)).reduce((u,_)=>u+_,0)/n),f=r.map(u=>u.perPage).reduce((u,_)=>u+_,0)/n,p=Math.sqrt(r.map(u=>Math.pow(u.perPage-f,2)).reduce((u,_)=>u+_,0)/n);return{average:l,deviation:g,perPageAverage:f,perPageDeviation:p}},d=i(e.map(r=>r.bubbles)),c=i(e.map(r=>r.words)),m=i(e.map(r=>r.characters));return{pages:{average:a,averageDeviation:o,meaningful:t,meaningfulDeviation:s},bubbles:d,words:c,characters:m}}function y(e,n,a,t,o=void 0){var l;const s=pe(e.diagram,e.perPage,t==null?void 0:t.perPageAverage,o==null?void 0:o.diagram),i=document.querySelector(`.results__${n}`),d=i.querySelector(`.results__info-group[data-result-name='${a}']`),c=t===void 0?void 0:(e.count-t.average)/t.deviation;q(d,e.count,t==null?void 0:t.average,c);const m=i.querySelector(`.results__info-group[data-result-name='${a}PerPage']`),r=t===void 0?void 0:(e.perPage-t.perPageAverage)/t.perPageDeviation;q(m,e.perPage,t==null?void 0:t.perPageAverage,r),(l=i.querySelector(".results__diagram"))==null||l.remove(),i.appendChild(s)}function be(e){const n=ye(e),a=e.lines.flat().length,t=a/n,o=e.lines.map(p=>p.length),s=A(o),i=e.words.flat().length,d=i/n,c=e.words.map(p=>p.length),m=A(c),r=e.words.map(p=>H(p.join(""))),l=r.flat().reduce((p,u)=>p+u,0),g=l/n,f=A(r.flat());return{title:void 0,pages:{count:e.lines.length,meaningful:n},bubbles:{count:a,perPage:t,diagram:s},words:{count:i,perPage:d,diagram:m},characters:{count:l,perPage:g,diagram:f}}}function A(e){const n=[];return e.forEach(a=>{const t=n.find(o=>o.value===a);if(t){t.count++;return}n.push({value:a,count:1})}),n}function ye(e){return e.lines.filter(n=>H(n.join(""))>10).length}function H(e){var n,a;return(a=(n=e.match(/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g))==null?void 0:n.length)!=null?a:0}function we(){Ce()}let C;function M(){var e;(e=document.querySelector(".save__container"))==null||e.classList.add("save__container--hidden")}function qe(){var e;(e=document.querySelector(".save__container"))==null||e.classList.remove("save__container--hidden")}function U(){document.querySelectorAll(".saved-value__compare-button").forEach(e=>{e.classList.remove("saved-value__compare-button--hidden")})}function Se(){document.querySelectorAll(".saved-value__compare-button").forEach(e=>{e.classList.add("saved-value__compare-button--hidden")})}async function L(e){var d;if(window.localStorage.getItem("saves")===null){const c=await F();window.localStorage.setItem("saves",JSON.stringify(c))}const n=JSON.parse((d=window.localStorage.getItem("saves"))!=null?d:"[]"),a=document.querySelector("#savedValueTemplate"),t=document.querySelector(".saved-values__container");t.querySelectorAll(".saved-value__container").forEach(c=>c.remove()),n.forEach(c=>{var f;c.title===void 0&&(c.title="Untitled");const m=(f=a.content.firstElementChild)==null?void 0:f.cloneNode(!0),r=m.querySelector(".saved-value__name");r.textContent=c.title,r.title=c.title,m.querySelector(".saved-value__load-button").addEventListener("click",()=>{e==null||e(c),D(c.title),K()}),m.querySelector(".saved-value__compare-button").addEventListener("click",()=>{Le(c,c.title)}),t.appendChild(m)}),O()!==void 0&&U();const o=document.querySelector(".save__button"),s=document.querySelector(".save__title");s.addEventListener("input",()=>{o.disabled=s.value.trim()===""}),s.value="",o.addEventListener("click",()=>{var l;const c=s.value.trim();s.value="",o.disabled=!0;const m=O();if(!m)return;const r=JSON.parse((l=window.localStorage.getItem("saves"))!=null?l:"[]");r.some(g=>g.title===c)?(Ee(),C=()=>{const g=r.findIndex(f=>f.title===c);r[g]=x(P({},m),{title:c}),window.localStorage.setItem("saves",JSON.stringify(r)),L(e),D(c)}):(r.unshift(x(P({},m),{title:c})),window.localStorage.setItem("saves",JSON.stringify(r)),L(e),M(),D(c))}),document.querySelector(".saved-values__reload-button").addEventListener("click",async()=>{var g;const c=await F(!0),l=[...JSON.parse((g=window.localStorage.getItem("saves"))!=null?g:"[]").filter(f=>!c.some(p=>p.title===f.title)),...c];window.localStorage.setItem("saves",JSON.stringify(l)),L(e)})}function Ee(){document.querySelector(".save__confirm-popup-container").classList.remove("save__confirm-popup-container--hidden")}function $(){document.querySelector(".save__confirm-popup-container").classList.add("save__confirm-popup-container--hidden")}function Ce(){document.querySelector(".save__confirm-popup-button--yes").addEventListener("click",()=>{C==null||C(),$()}),document.querySelector(".save__confirm-popup-button--no").addEventListener("click",()=>{$()})}let v,h;function O(){return v}async function Le(e,n){h=e,document.querySelector(".results").classList.add("results--comparing");const t=await G(),o=document.querySelector(".results__info-group[data-result-name='pagesCompare']"),s=t===void 0?void 0:(h.pages.count-t.pages.average)/t.pages.averageDeviation;q(o,h.pages.count,t==null?void 0:t.pages.average,s);const i=document.querySelector(".results__info-group[data-result-name='meaningfulPagesCompare']"),d=t===void 0?void 0:(h.pages.meaningful-t.pages.meaningful)/t.pages.meaningfulDeviation;q(i,h.pages.meaningful,t==null?void 0:t.pages.meaningful,d),y(h.bubbles,"compare-bubbles","bubblesCompare",t==null?void 0:t.bubbles,v==null?void 0:v.bubbles),y(h.words,"compare-words","wordsCompare",t==null?void 0:t.words,v==null?void 0:v.words),y(h.characters,"compare-characters","charactersCompare",t==null?void 0:t.characters,v==null?void 0:v.characters),y(v.bubbles,"bubbles","bubbles",t==null?void 0:t.bubbles,h.bubbles),y(v.words,"words","words",t==null?void 0:t.words,h.words),y(v.characters,"characters","characters",t==null?void 0:t.characters,h.characters);const c=document.querySelector(".results__compare-column-title--compare .results__compare-column-title-subtext");c.innerText=n}function K(){h=void 0,document.querySelector(".results").classList.remove("results--comparing")}function D(e){const n=document.querySelector(".results__compare-column-title--current .results__compare-column-title-subtext");n.innerText=e}function Pe(){const e=document.querySelector(".results__compare-column-title--current .results__compare-column-title-subtext");e.innerText=""}function z(){var e;(e=document.querySelector(".results"))==null||e.classList.add("results--hidden")}async function J(e){var m;(m=document.querySelector(".results"))==null||m.classList.remove("results--hidden");const n=W("showAveragesFor"),a=document.querySelector(".results");a.dataset.showAveragesFor=n;const t="title"in e?e:be(e),o=await G();v=t,U();const s=document.querySelector(".results__info-group[data-result-name='pages']"),i=o===void 0?void 0:(t.pages.count-o.pages.average)/o.pages.averageDeviation;q(s,t.pages.count,o==null?void 0:o.pages.average,i);const d=document.querySelector(".results__info-group[data-result-name='meaningfulPages']"),c=o===void 0?void 0:(t.pages.meaningful-o.pages.meaningful)/o.pages.meaningfulDeviation;q(d,t.pages.meaningful,o==null?void 0:o.pages.meaningful,c),y(t.bubbles,"bubbles","bubbles",o==null?void 0:o.bubbles),y(t.words,"words","words",o==null?void 0:o.words),y(t.characters,"characters","characters",o==null?void 0:o.characters),document.querySelectorAll(".results__diagram-column").forEach(r=>{const l=r.style.height;r.animate([{height:"0"},{height:l}],500)})}let T;async function F(e=!1){if(T&&!e)return T;const n=await(await fetch("/manga-analyzer/selected_results.json")).json();return T=n,n}async function xe(){we(),ne(),L(async e=>{M(),z(),await J(e)}),fe(),oe(async e=>{M(),z(),Se(),K(),Pe();const n=await ce(e);await J(n),qe()})}document.addEventListener("DOMContentLoaded",xe);
