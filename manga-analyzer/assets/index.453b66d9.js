var $=Object.defineProperty,k=Object.defineProperties;var O=Object.getOwnPropertyDescriptors;var x=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var A=(e,t,n)=>t in e?$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,M=(e,t)=>{for(var n in t||(t={}))R.call(t,n)&&A(e,n,t[n]);if(x)for(var n of x(t))z.call(t,n)&&A(e,n,t[n]);return e},T=(e,t)=>k(e,O(t));import"./vendor.0bc0745c.js";const V=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerpolicy&&(s.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?s.credentials="include":o.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function a(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}};V();function B(){const e=document.querySelector(".upload__drop-zone"),t=document.querySelector(".upload__file-input"),n=document.querySelector(".upload__button"),a=document.querySelector(".upload__drop-zone-text");t.files=null,n.disabled=!0,e.addEventListener("click",()=>{t.click()}),t.addEventListener("change",()=>{const o=t.files;o!=null&&(n.classList.add("upload__button--excited"),n.classList.remove("upload__button--inactive"),n.disabled=!1,a.textContent=`${o.length} files selected`)}),n.addEventListener("click",()=>{n.classList.remove("upload__button--excited")})}function J(e){document.querySelector(".upload__button").addEventListener("click",()=>{var o;const n=document.querySelector(".upload__file-input"),a=Array.from((o=n.files)!=null?o:[]);e(a)})}const _={adjective:"\u5F62\u5BB9\u8A5E",adverb:"\u526F\u8A5E",adnominal:"\u9023\u4F53\u8A5E",filler:"\u30D5\u30A3\u30E9\u30FC",conjunction:"\u63A5\u7D9A\u8A5E",noun:"\u540D\u8A5E",auxiliaryVerb:"\u52A9\u52D5\u8A5E",interjection:"\u611F\u52D5\u8A5E",other:"\u305D\u306E\u4ED6",prefix:"\u63A5\u982D\u8A5E",particle:"\u52A9\u8A5E",symbol:"\u8A18\u53F7",verb:"\u52D5\u8A5E"};function H(){var e;(e=document.querySelector(".loading"))==null||e.classList.remove("loading--hidden")}function W(){var e;(e=document.querySelector(".loading"))==null||e.classList.add("loading--hidden")}function D(e){const t=document.querySelector(".loading__text");t.textContent=e}let P;async function G(e){H(),U(e);const t=await K(e),n=Y(t);P===void 0&&(P=await Z());const a=Q(n);return W(),{lines:n,words:a}}function U(e){const t=n=>parseInt(n.name.split(".")[0]);return e.sort((n,a)=>t(n)-t(a))}async function K(e){const t=[];for(const n of e){D(`Loading files... ${t.length+1}/${e.length}`);const a=await X(n);t.push(a)}return t}async function X(e){const t=new FileReader;return t.readAsText(e),new Promise((n,a)=>{t.onload=()=>{const o=JSON.parse(t.result);n(o)},t.onerror=()=>{a(t.error)}})}function Y(e){return e.map(t=>t.blocks.map(n=>n.lines.join(" ")))}function Z(){return D("Loading kuromoji..."),new Promise((e,t)=>{kuromoji.builder({dicPath:"https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict"}).build((n,a)=>{n&&t(n),e(a)})})}function Q(e){return D("Extracting words..."),e.map(t=>t.flatMap(n=>ee(n)))}function ee(e){const t=[_.noun,_.verb,_.adverb,_.adjective,_.adnominal];return P.tokenize(e).filter(a=>t.includes(a.pos)&&a.basic_form!=="*").map(a=>a.basic_form)}let I;function te(){return I}function F(){var e;(e=document.querySelector(".results"))==null||e.classList.add("results--hidden")}async function j(e){var d;(d=document.querySelector(".results"))==null||d.classList.remove("results--hidden");const t="title"in e?e:oe(e),n=await ne();I=t;const a=document.querySelector(".results__info-group[data-result-name='pages']"),o=(t.pages.count-n.pages.average)/n.pages.averageDeviation;b(a,t.pages.count,n.pages.average,o);const s=document.querySelector(".results__info-group[data-result-name='meaningfulPages']"),i=(t.pages.meaningful-n.pages.meaningful)/n.pages.meaningfulDeviation;b(s,t.pages.meaningful,n.pages.meaningful,i),q(t.bubbles,"bubbles",n.bubbles),q(t.words,"words",n.words),q(t.characters,"characters",n.characters),document.querySelectorAll(".results__diagram-column").forEach(l=>{const m=l.style.height;l.animate([{height:"0"},{height:m}],500)})}async function ne(){const e=await E(),t=e.length,n=e.map(r=>r.pages.count).reduce((r,c)=>r+c,0)/t,a=e.map(r=>r.pages.meaningful).reduce((r,c)=>r+c,0)/t,o=Math.sqrt(e.map(r=>Math.pow(r.pages.count-n,2)).reduce((r,c)=>r+c,0)/t),s=Math.sqrt(e.map(r=>Math.pow(r.pages.meaningful-a,2)).reduce((r,c)=>r+c,0)/t),i=r=>{const c=r.map(u=>u.count).reduce((u,p)=>u+p,0)/t,g=Math.sqrt(r.map(u=>Math.pow(u.count-c,2)).reduce((u,p)=>u+p,0)/t),v=r.map(u=>u.perPage).reduce((u,p)=>u+p,0)/t,f=Math.sqrt(r.map(u=>Math.pow(u.perPage-v,2)).reduce((u,p)=>u+p,0)/t);return{average:c,deviation:g,perPageAverage:v,perPageDeviation:f}},d=i(e.map(r=>r.bubbles)),l=i(e.map(r=>r.words)),m=i(e.map(r=>r.characters));return{pages:{average:n,averageDeviation:o,meaningful:a,meaningfulDeviation:s},bubbles:d,words:l,characters:m}}let S;async function E(e=!1){if(S&&!e)return S;const t=await(await fetch("/manga-analyzer/selected_results.json")).json();return S=t,t}function oe(e){const t=ae(e),n=e.lines.flat().length,a=n/t,o=e.lines.map(f=>f.length),s=w(o),i=e.words.flat().length,d=i/t,l=e.words.map(f=>f.length),m=w(l),r=e.words.map(f=>N(f.join(""))),c=r.flat().reduce((f,u)=>f+u,0),g=c/t,v=w(r.flat());return{title:void 0,pages:{count:e.lines.length,meaningful:t},bubbles:{count:n,perPage:a,diagram:s},words:{count:i,perPage:d,diagram:m},characters:{count:c,perPage:g,diagram:v}}}function w(e){const t=[];return e.forEach(n=>{const a=t.find(o=>o.value===n);if(a){a.count++;return}t.push({value:n,count:1})}),t}function ae(e){return e.lines.filter(t=>N(t.join(""))>10).length}function N(e){var t,n;return(n=(t=e.match(/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g))==null?void 0:t.length)!=null?n:0}function q(e,t,n){var m;const a=re(e.diagram,e.perPage,n.perPageAverage),o=document.querySelector(`.results__${t}`),s=o.querySelector(`.results__info-group[data-result-name='${t}']`),i=(e.count-n.average)/n.deviation;b(s,e.count,n.average,i);const d=o.querySelector(`.results__info-group[data-result-name='${t}PerPage']`),l=(e.perPage-n.perPageAverage)/n.perPageDeviation;b(d,e.perPage,n.perPageAverage,l),(m=o.querySelector(".results__diagram"))==null||m.remove(),o.appendChild(a)}function b(e,t,n,a){const o=e.querySelector(".results__info-value"),s=e.querySelector(".results__info-average"),i=e.querySelector(".results__info-deviation");o.textContent=y(t),s.textContent=y(n);const d=a>0?"+":"";i.textContent=d+y(a)}function y(e){return(Math.round(e*100)/100).toString()}function re(e,t,n){const a=document.querySelector("#diagramTemplate"),o=a.content.querySelector(".results__diagram").cloneNode(!0),s=a.content.querySelector("#diagramColumnTemplate"),i=a.content.querySelector("#diagramColumnWithHorizontalTemplate"),d=a.content.querySelector("#diagramHorizontalLineTemplate"),l=a.content.querySelector("#diagramAverageLineTemplate"),m=a.content.querySelector("#diagramValueLineTemplate"),r=o.querySelector(".results__diagram-data"),c=Math.min(...e.map(h=>h.value),n),g=Math.max(...e.map(h=>h.value),n),v=Math.max(...e.map(h=>h.count)),f=v*1.25,u=Math.max(Math.floor(c-3),0),p=Math.ceil(g+3);return se(u,p,f,e,r,s,i),le(f,v,d,r),ue(t,n,p,r,l,m),o}function se(e,t,n,a,o,s,i){var m,r;const d=100/(t-e+1),l=Math.ceil(20/d);for(let c=0;c<=t-e;c++){const g=e+c,v=(r=(m=a.find(u=>u.value===g))==null?void 0:m.count)!=null?r:0,f=v/n*100;if(c%l===0&&c!==0){const u=i.content.firstElementChild.cloneNode(!0),p=u.querySelector(".results__diagram-column-value"),h=u.querySelector(".results__diagram-horizontal-value");p.textContent=`${g}: ${v}`,h.textContent=y(g),u.style.height=`${f}%`,u.style.width=`${d}%`,o.appendChild(u)}else{const u=s.content.firstElementChild.cloneNode(!0),p=u.querySelector(".results__diagram-column-value");p.textContent=`${g}: ${v}`,u.style.height=`${f}%`,u.style.width=`${d}%`,o.appendChild(u)}}}function le(e,t,n,a){const o=Math.floor(t/5),s=o/e*100;for(let i=0;i<5;i++){const d=n.content.firstElementChild.cloneNode(!0);d.style.height=`${s*(i+1)}%`;const l=d.querySelector(".results__diagram-horizontal-line-text");l.textContent=(o*(i+1)).toString(),a.appendChild(d)}}function ue(e,t,n,a,o,s){const i=t/n*100,d=e/n*100,l=o.content.firstElementChild.cloneNode(!0);l.style.width=`${i}%`;const m=l.querySelector(".results__diagram-average-text");m.textContent=y(t);const r=s.content.firstElementChild.cloneNode(!0);r.style.width=`${d}%`;const c=r.querySelector(".results__diagram-value-text");c.textContent=y(e);const g=[l,r];t>e&&g.reverse(),a.append(...g)}function C(){var e;(e=document.querySelector(".save__container"))==null||e.classList.add("save__container--hidden")}function ce(){var e;(e=document.querySelector(".save__container"))==null||e.classList.remove("save__container--hidden")}async function L(e){var d;if(window.localStorage.getItem("saves")===null){const l=await E();window.localStorage.setItem("saves",JSON.stringify(l))}const t=JSON.parse((d=window.localStorage.getItem("saves"))!=null?d:"[]"),n=document.querySelector("#savedValueTemplate"),a=document.querySelector(".saved-values__container");a.querySelectorAll(".saved-value__container").forEach(l=>l.remove()),t.forEach(l=>{var g;l.title===void 0&&(l.title="Untitled");const m=(g=n.content.firstElementChild)==null?void 0:g.cloneNode(!0),r=m.querySelector(".saved-value__name");r.textContent=l.title,r.title=l.title,m.querySelector(".saved-value__load-button").addEventListener("click",()=>{e==null||e(l)}),a.appendChild(m)});const o=document.querySelector(".save__button"),s=document.querySelector(".save__title");s.addEventListener("input",()=>{o.disabled=s.value.trim()===""}),s.value="",o.addEventListener("click",()=>{var c;const l=s.value.trim();s.value="",o.disabled=!0;const m=te();if(!m)return;const r=JSON.parse((c=window.localStorage.getItem("saves"))!=null?c:"[]");r.unshift(T(M({},m),{title:l})),window.localStorage.setItem("saves",JSON.stringify(r)),L(e),C()}),document.querySelector(".saved-values__reload-button").addEventListener("click",async()=>{var g;const l=await E(!0),c=[...JSON.parse((g=window.localStorage.getItem("saves"))!=null?g:"[]").filter(v=>!l.some(f=>f.title===v.title)),...l];window.localStorage.setItem("saves",JSON.stringify(c)),L(e)})}async function ie(){B(),L(async e=>{C(),F(),await j(e)}),J(async e=>{C(),F();const t=await G(e);await j(t),ce()})}document.addEventListener("DOMContentLoaded",ie);
