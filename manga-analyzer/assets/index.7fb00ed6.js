var ce=Object.defineProperty,le=Object.defineProperties;var re=Object.getOwnPropertyDescriptors;var z=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var V=(e,n,t)=>n in e?ce(e,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[n]=t,N=(e,n)=>{for(var t in n||(n={}))ie.call(n,t)&&V(e,t,n[t]);if(z)for(var t of z(n))se.call(n,t)&&V(e,t,n[t]);return e},k=(e,n)=>le(e,re(n));import"./vendor.0bc0745c.js";const ue=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const l of c.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function t(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerpolicy&&(c.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?c.credentials="include":a.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function o(a){if(a.ep)return;a.ep=!0;const c=t(a);fetch(a.href,c)}};ue();function de(){const e=document.querySelector(".upload__drop-zone"),n=document.querySelector(".upload__file-input"),t=document.querySelector(".upload__button"),o=document.querySelector(".upload__drop-zone-text");n.files=null,t.disabled=!0,e.addEventListener("click",()=>{n.click()}),n.addEventListener("change",()=>{const a=n.files;a!=null&&(t.classList.add("upload__button--excited"),t.classList.remove("upload__button--inactive"),t.disabled=!1,o.textContent=`${a.length} files selected`)}),t.addEventListener("click",()=>{t.classList.remove("upload__button--excited")})}function ge(e){document.querySelector(".upload__button").addEventListener("click",()=>{var a;const t=document.querySelector(".upload__file-input"),o=Array.from((a=t.files)!=null?a:[]);e(o)})}const E={adjective:"\u5F62\u5BB9\u8A5E",adverb:"\u526F\u8A5E",adnominal:"\u9023\u4F53\u8A5E",filler:"\u30D5\u30A3\u30E9\u30FC",conjunction:"\u63A5\u7D9A\u8A5E",noun:"\u540D\u8A5E",auxiliaryVerb:"\u52A9\u52D5\u8A5E",interjection:"\u611F\u52D5\u8A5E",other:"\u305D\u306E\u4ED6",prefix:"\u63A5\u982D\u8A5E",particle:"\u52A9\u8A5E",symbol:"\u8A18\u53F7",verb:"\u52D5\u8A5E"};function me(){var e;(e=document.querySelector(".loading"))==null||e.classList.remove("loading--hidden")}function fe(){var e;(e=document.querySelector(".loading"))==null||e.classList.add("loading--hidden")}function T(e){const n=document.querySelector(".loading__text");n.textContent=e}let J;async function pe(e){_e(e);const n=await he(e),t=ye(n);J===void 0&&(J=await be());const o=we(t);return{lines:t,words:o}}function _e(e){const n=t=>parseInt(t.name.split(".")[0]);return e.sort((t,o)=>n(t)-n(o))}async function he(e){const n=[];for(const t of e){T(`Loading files... ${n.length+1}/${e.length}`);const o=await ve(t);n.push(o)}return n}async function ve(e){const n=new FileReader;return n.readAsText(e),new Promise((t,o)=>{n.onload=()=>{const a=JSON.parse(n.result);t(a)},n.onerror=()=>{o(n.error)}})}function ye(e){return e.map(n=>n.blocks.map(t=>t.lines.join(" ")))}function be(){return T("Loading kuromoji..."),new Promise((e,n)=>{kuromoji.builder({dicPath:"https://cdn.jsdelivr.net/npm/kuromoji@0.1.2/dict"}).build((t,o)=>{t&&n(t),e(o)})})}function we(e){return T("Extracting words..."),e.map(n=>n.flatMap(t=>qe(t)))}function qe(e){const n=[E.noun,E.verb,E.adverb,E.adjective,E.adnominal];return J.tokenize(e).filter(o=>n.includes(o.pos)&&o.basic_form!=="*").map(o=>o.basic_form)}function C(e){return(Math.round(e*100)/100).toString()}function M(e,n,t,o,a){const c={showVerticalLines:!0,showAllLabels:!1,omitPadding:!1};a!=null||(a=c);for(const _ in c)_ in a||(a[_]=c[_]);const l=document.querySelector("#diagramTemplate"),i=l.content.querySelector(".results__diagram").cloneNode(!0),s=l.content.querySelector("#diagramColumnTemplate"),d=l.content.querySelector("#diagramColumnWithHorizontalTemplate"),f=l.content.querySelector("#diagramHorizontalLineTemplate"),r=l.content.querySelector("#diagramAverageLineTemplate"),g=l.content.querySelector("#diagramValueLineTemplate"),y=i.querySelector(".results__diagram-data"),v=Math.min(...e.map(_=>_.value),...t?[t]:[],...(o!=null?o:[]).map(_=>_.value)),b=Math.max(...e.map(_=>_.value),...t?[t]:[],...(o!=null?o:[]).map(_=>_.value)),m=Math.max(...e.map(_=>_.count),...(o!=null?o:[]).map(_=>_.count)),h=m*1.25,u=a.omitPadding?0:3,p=Math.max(Math.floor(v-u),0),w=Math.ceil(b+u);return Le(p,w,h,e,y,s,d,a),Ee(h,m,f,y),a.showVerticalLines&&Ce(n,t,w,y,r,g),i}function Le(e,n,t,o,a,c,l,i){var f,r;const s=100/(n-e+1),d=Math.ceil(20/s);for(let g=0;g<=n-e;g++){const y=e+g,v=o.find(u=>u.value===y),b=(f=v==null?void 0:v.count)!=null?f:0,m=(r=v==null?void 0:v.label)!=null?r:y,h=b/t*100;if(g%d===0&&g!==0||i.showAllLabels){const u=l.content.firstElementChild.cloneNode(!0),p=u.querySelector(".results__diagram-column-value"),w=u.querySelector(".results__diagram-horizontal-value");p.textContent=`${m}: ${b}`,w.textContent=m.toString(),u.style.height=`${h}%`,u.style.width=`${s}%`,a.appendChild(u)}else{const u=c.content.firstElementChild.cloneNode(!0),p=u.querySelector(".results__diagram-column-value");p.textContent=`${m}: ${b}`,u.style.height=`${h}%`,u.style.width=`${s}%`,a.appendChild(u)}}}function Ee(e,n,t,o){const a=e<15?1:e<100?5:10,c=Math.ceil(n/5/a)*a,l=c/e*100,i=Math.floor(e/c);for(let s=0;s<i;s++){const d=t.content.firstElementChild.cloneNode(!0);d.style.height=`${l*(s+1)}%`;const f=d.querySelector(".results__diagram-horizontal-line-text");f.textContent=(c*(s+1)).toString(),o.appendChild(d)}}function Ce(e,n,t,o,a,c){const l=[];if(n){const i=n/t*100,s=a.content.firstElementChild.cloneNode(!0);s.style.width=`${i}%`;const d=s.querySelector(".results__diagram-average-text");d.textContent=C(n),l.push(s)}if(e){const i=e/t*100,s=c.content.firstElementChild.cloneNode(!0);s.style.width=`${i}%`;const d=s.querySelector(".results__diagram-value-text");d.textContent=C(e),l.push(s)}e&&n&&n>e&&l.reverse(),o.append(...l)}function L(e,n,t,o){const a=e.querySelector(".results__info-value"),c=e.querySelector(".results__info-average"),l=e.querySelector(".results__info-deviation");if(a.textContent=C(n),t!==void 0&&o!==void 0){c.textContent=C(t);const i=o>0?"+":"";l.textContent=i+C(o)}e.classList.toggle("results__info-group--no-average",t===void 0)}const G={showAveragesFor:"abbc"};function Pe(){const e=document.querySelector(".settings__icon"),n=document.querySelector(".settings");e.addEventListener("click",()=>{n.classList.toggle("settings--open")});const t=X();for(const o in t){const a=document.querySelector(`#${o}`);a.value=t[o],a.addEventListener("change",()=>{t[o]=a.value,Y(t)})}}function X(){return window.localStorage.getItem("settings")===null?(Y(G),G):JSON.parse(window.localStorage.getItem("settings"))}function Y(e){window.localStorage.setItem("settings",JSON.stringify(e))}function Z(e){return X()[e]}async function Q(){if(Z("showAveragesFor")==="none")return;const e=await $(),n=e.length,t=e.map(r=>r.pages.count).reduce((r,g)=>r+g,0)/n,o=e.map(r=>r.pages.meaningful).reduce((r,g)=>r+g,0)/n,a=Math.sqrt(e.map(r=>Math.pow(r.pages.count-t,2)).reduce((r,g)=>r+g,0)/n),c=Math.sqrt(e.map(r=>Math.pow(r.pages.meaningful-o,2)).reduce((r,g)=>r+g,0)/n),l=r=>{const g=r.map(m=>m.count).reduce((m,h)=>m+h,0)/n,y=Math.sqrt(r.map(m=>Math.pow(m.count-g,2)).reduce((m,h)=>m+h,0)/n),v=r.map(m=>m.perPage).reduce((m,h)=>m+h,0)/n,b=Math.sqrt(r.map(m=>Math.pow(m.perPage-v,2)).reduce((m,h)=>m+h,0)/n);return{average:g,deviation:y,perPageAverage:v,perPageDeviation:b}},i=l(e.map(r=>r.bubbles)),s=l(e.map(r=>r.words)),d=l(e.map(r=>r.characters)),f=e.some(r=>r.uniqueWords===void 0)?void 0:l(e.map(r=>r.uniqueWords));return{pages:{average:t,averageDeviation:a,meaningful:o,meaningfulDeviation:c},bubbles:i,words:s,characters:d,uniqueWords:f}}function q(e,n,t,o,a,c=!0){var g;const l=M(e.diagram,e.perPage,o==null?void 0:o.perPageAverage,a==null?void 0:a.diagram,{showVerticalLines:c}),i=document.querySelector(`.results__${n}`),s=i.querySelector(`.results__info-group[data-result-name='${t}']`),d=o===void 0?void 0:(e.count-o.average)/o.deviation;L(s,e.count,o==null?void 0:o.average,d);const f=i.querySelector(`.results__info-group[data-result-name='${t}PerPage']`),r=o===void 0?void 0:(e.perPage-o.perPageAverage)/o.perPageDeviation;L(f,e.perPage,o==null?void 0:o.perPageAverage,r),(g=i.querySelector(".results__diagram"))==null||g.remove(),i.appendChild(l)}let I;async function Ae(e){I===void 0&&(T("Loading JLPT data..."),I=(await(await fetch("jlpt.csv")).text()).split(`
`).map(p=>p.split(",")).map(p=>({kanji:p[0],kana:p[1],jlptLevel:parseInt(p[2])})));const n=je(e),t=e.lines.flat().length,o=t/n,a=e.lines.map(u=>u.length),c=W(a),l=e.words.flat().length,i=l/n,s=e.words.map(u=>u.length),d=W(s),f=e.words.map(u=>R(u.join(""))),r=f.flat().reduce((u,p)=>u+p,0),g=r/n,y=W(f.flat()),v=new Set,b=e.words.map(u=>{const p=u.filter(w=>!v.has(w));return p.forEach(w=>v.add(w)),p}),m=b.flat().length,h={n1:0,n2:0,n3:0,n4:0,n5:0,unknown:0};return v.forEach(u=>{const p=I.find(_=>_.kanji===u||_.kana===u);if(!p){h.unknown++;return}const w=`n${p.jlptLevel}`;h[w]++}),{title:void 0,pages:{count:e.lines.length,meaningful:n},bubbles:{count:t,perPage:o,diagram:c},words:{count:l,perPage:i,diagram:d},characters:{count:r,perPage:g,diagram:y},uniqueWords:{count:m,perPage:m/n,diagram:b.map((u,p)=>({value:p+1,count:u.length}))},jlptStats:h}}function W(e){const n=[];return e.forEach(t=>{const o=n.find(a=>a.value===t);if(o){o.count++;return}n.push({value:t,count:1})}),n}function je(e){return e.lines.filter(n=>R(n.join(""))>10).length}function R(e){var n,t;return(t=(n=e.match(/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/g))==null?void 0:n.length)!=null?t:0}function xe(){Ie();const e=document.querySelector(".save__button"),n=document.querySelector(".save__title");n.addEventListener("input",()=>{e.disabled=n.value.trim()===""}),n.value="",e.addEventListener("click",()=>{var s;const c=n.value.trim();n.value="",e.disabled=!0;const l=te();if(!l)return;const i=JSON.parse((s=window.localStorage.getItem("saves"))!=null?s:"[]");i.some(d=>d.title===c)?(ke(),A=()=>{const d=i.findIndex(f=>f.title===c);i[d]=k(N({},l),{title:c}),window.localStorage.setItem("saves",JSON.stringify(i)),x(),O(c)}):(i.unshift(k(N({},l),{title:c})),window.localStorage.setItem("saves",JSON.stringify(i)),x(),B(),O(c))}),document.querySelector(".saved-values__reload-button").addEventListener("click",async()=>{const c=await $(!0);console.log(c),ne(c)}),document.querySelector(".saved-values__download-json-button").addEventListener("click",Te),document.querySelector(".saved-values__load-json-button").addEventListener("click",Ne)}let A;function B(){var e;(e=document.querySelector(".save__container"))==null||e.classList.add("save__container--hidden")}function De(){var e;(e=document.querySelector(".save__container"))==null||e.classList.remove("save__container--hidden")}function ee(){document.querySelectorAll(".saved-value__compare-button").forEach(e=>{e.classList.remove("saved-value__compare-button--hidden")})}function Se(){document.querySelectorAll(".saved-value__compare-button").forEach(e=>{e.classList.add("saved-value__compare-button--hidden")})}let P;async function x(e){var a;if(e!==void 0&&(P=e),window.localStorage.getItem("saves")===null){const c=await $();window.localStorage.setItem("saves",JSON.stringify(c))}const n=JSON.parse((a=window.localStorage.getItem("saves"))!=null?a:"[]"),t=document.querySelector("#savedValueTemplate"),o=document.querySelector(".saved-values__container");o.querySelectorAll(".saved-value__container").forEach(c=>c.remove()),n.forEach(c=>{var f;c.title===void 0&&(c.title="Untitled");const l=(f=t.content.firstElementChild)==null?void 0:f.cloneNode(!0),i=l.querySelector(".saved-value__name");i.textContent=c.title,i.title=c.title,l.querySelector(".saved-value__load-button").addEventListener("click",()=>{P==null||P(c),O(c.title),ae()}),l.querySelector(".saved-value__compare-button").addEventListener("click",()=>{We(c,c.title)}),o.appendChild(l)}),te()!==void 0&&ee()}function Te(){var o;const e=(o=window.localStorage.getItem("saves"))!=null?o:"[]",n="data:text/json;charset=utf-8,"+encodeURIComponent(e),t=document.createElement("a");t.setAttribute("href",n),t.setAttribute("download","saves.json"),t.click(),t.remove()}function Ne(){const e=document.createElement("input");e.type="file",e.accept=".json",e.addEventListener("change",()=>{var o;const n=(o=e.files)==null?void 0:o[0];if(!n)return;const t=new FileReader;t.onload=()=>{const a=JSON.parse(t.result);ne(a)},t.readAsText(n)}),document.body.appendChild(e),e.click(),e.remove()}function ne(e){var a;const o=[...JSON.parse((a=window.localStorage.getItem("saves"))!=null?a:"[]").filter(c=>!e.some(l=>l.title===c.title)),...e];console.log(o),window.localStorage.setItem("saves",JSON.stringify(o)),x()}function ke(){document.querySelector(".save__confirm-popup-container").classList.remove("save__confirm-popup-container--hidden")}function H(){document.querySelector(".save__confirm-popup-container").classList.add("save__confirm-popup-container--hidden")}function Ie(){document.querySelector(".save__confirm-popup-button--yes").addEventListener("click",()=>{A==null||A(),H()}),document.querySelector(".save__confirm-popup-button--no").addEventListener("click",()=>{H()})}let D,j;function te(){return D}async function We(e,n){j=e,document.querySelector(".results").classList.add("results--comparing");const o=await Q();oe(D,o,j),Fe(j,o,D),document.querySelectorAll(".results__diagram-column").forEach(c=>{const l=c.style.height;c.animate([{height:"0"},{height:l}],500)});const a=document.querySelector(".results__compare-column-title--compare .results__compare-column-title-subtext");a.innerText=n}function oe(e,n,t){var s,d;const o=document.querySelector(".results__info-group[data-result-name='pages']"),a=n===void 0?void 0:(e.pages.count-n.pages.average)/n.pages.averageDeviation;L(o,e.pages.count,n==null?void 0:n.pages.average,a);const c=document.querySelector(".results__info-group[data-result-name='meaningfulPages']"),l=n===void 0?void 0:(e.pages.meaningful-n.pages.meaningful)/n.pages.meaningfulDeviation;L(c,e.pages.meaningful,n==null?void 0:n.pages.meaningful,l),q(e.bubbles,"bubbles","bubbles",n==null?void 0:n.bubbles,t==null?void 0:t.bubbles),q(e.words,"words","words",n==null?void 0:n.words),q(e.characters,"characters","characters",n==null?void 0:n.characters,t==null?void 0:t.characters),e.uniqueWords&&q(e.uniqueWords,"unique-words","uniqueWords",n==null?void 0:n.uniqueWords,t==null?void 0:t.uniqueWords,!1),(s=document.querySelector(".results__unique-words"))==null||s.classList.toggle("results__group--hidden",!e.uniqueWords);const i=document.querySelector(".results__jlpt");if(i.classList.toggle("results__group--hidden",!e.jlptStats),e.jlptStats){(d=i.querySelector(".results__diagram"))==null||d.remove();const f=S(e.jlptStats),r=t!=null&&t.jlptStats?S(t.jlptStats):void 0,g=M(f,void 0,void 0,r,{omitPadding:!0,showAllLabels:!0,showVerticalLines:!1});i.append(g)}}function Fe(e,n,t){var f,r;const o=document.querySelector(".results__info-group[data-result-name='pagesCompare']"),a=n===void 0?void 0:(e.pages.count-n.pages.average)/n.pages.averageDeviation;L(o,e.pages.count,n==null?void 0:n.pages.average,a);const c=document.querySelector(".results__info-group[data-result-name='meaningfulPagesCompare']"),l=n===void 0?void 0:(e.pages.meaningful-n.pages.meaningful)/n.pages.meaningfulDeviation;L(c,e.pages.meaningful,n==null?void 0:n.pages.meaningful,l),q(e.bubbles,"compare-bubbles","bubblesCompare",n==null?void 0:n.bubbles,t==null?void 0:t.bubbles),q(e.words,"compare-words","wordsCompare",n==null?void 0:n.words,t==null?void 0:t.words),q(e.characters,"compare-characters","charactersCompare",n==null?void 0:n.characters,t==null?void 0:t.characters),e.uniqueWords&&q(e.uniqueWords,"compare-unique-words","uniqueWordsCompare",n==null?void 0:n.uniqueWords,t==null?void 0:t.uniqueWords,!1),(f=document.querySelector(".results__compare-unique-words"))==null||f.classList.toggle("results__group--hidden",!e.uniqueWords);const i=t.jlptStats?S(t.jlptStats):void 0,s=e.jlptStats?S(e.jlptStats):void 0,d=document.querySelector(".results__compare-jlpt");if(e!=null&&e.jlptStats){(r=d.querySelector(".results__diagram"))==null||r.remove();const g=M(s,void 0,void 0,i,{omitPadding:!0,showAllLabels:!0,showVerticalLines:!1});d.append(g)}d.classList.toggle("results__group--hidden",!(e!=null&&e.jlptStats))}function S(e){return[{count:e.n5,value:0,label:"N5"},{count:e.n4,value:1,label:"N4"},{count:e.n3,value:2,label:"N3"},{count:e.n2,value:3,label:"N2"},{count:e.n1,value:4,label:"N1"},{count:e.unknown,value:5,label:"?"}]}function ae(){j=void 0,document.querySelector(".results").classList.remove("results--comparing")}function O(e){const n=document.querySelector(".results__compare-column-title--current .results__compare-column-title-subtext");n.innerText=e}function Je(){const e=document.querySelector(".results__compare-column-title--current .results__compare-column-title-subtext");e.innerText=""}function U(){var e;(e=document.querySelector(".results"))==null||e.classList.add("results--hidden")}async function K(e){var c;const n=Z("showAveragesFor"),t=document.querySelector(".results");t.dataset.showAveragesFor=n;const o="title"in e?e:await Ae(e),a=await Q();oe(o,a),(c=document.querySelector(".results"))==null||c.classList.remove("results--hidden"),D=o,ee(),document.querySelectorAll(".results__diagram-column").forEach(l=>{const i=l.style.height;l.animate([{height:"0"},{height:i}],500)})}let F;async function $(e=!1){if(F&&!e)return F;const n=await(await fetch("selected_results.json")).json();return F=n,n}async function Be(){xe(),de(),x(async t=>{B(),U(),await K(t)}),Pe(),ge(async t=>{B(),U(),Se(),ae(),Je(),me();const o=await pe(t);await K(o),fe(),De()});const e=document.querySelector(".sidebar__toggle-icon"),n=document.querySelector(".sidebar__container");e.addEventListener("click",()=>n.classList.toggle("sidebar__container--closed"))}document.addEventListener("DOMContentLoaded",Be);
